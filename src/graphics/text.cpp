#include "text.h"

/* font bitmap 5x7 (space, 0-9, A-Z, ( ) . :) */
static const unsigned char font5x7[][5] = {
    {0x00,0x00,0x00,0x00,0x00}, // space
    {0x3E,0x45,0x49,0x51,0x3E}, //0
    {0x00,0x21,0x7F,0x01,0x00}, //1
    {0x21,0x43,0x45,0x49,0x31}, //2
    {0x42,0x41,0x51,0x69,0x46}, //3
    {0x0C,0x14,0x24,0x7F,0x04}, //4
    {0x72,0x51,0x51,0x51,0x4E}, //5
    {0x3E,0x49,0x49,0x49,0x26}, //6
    {0x40,0x47,0x48,0x50,0x60}, //7
    {0x36,0x49,0x49,0x49,0x36}, //8
    {0x32,0x49,0x49,0x49,0x3E}, //9
    {0x7C,0x12,0x11,0x12,0x7C}, //A
    {0x7F,0x49,0x49,0x49,0x36}, //B
    {0x3E,0x41,0x41,0x41,0x22}, //C
    {0x7F,0x41,0x41,0x22,0x1C}, //D
    {0x7F,0x49,0x49,0x49,0x41}, //E
    {0x7F,0x09,0x09,0x09,0x01}, //F
    {0x3E,0x41,0x49,0x49,0x7A}, //G
    {0x7F,0x08,0x08,0x08,0x7F}, //H
    {0x00,0x41,0x7F,0x41,0x00}, //I
    {0x20,0x40,0x41,0x3F,0x01}, //J
    {0x7F,0x08,0x14,0x22,0x41}, //K
    {0x7F,0x40,0x40,0x40,0x40}, //L
    {0x7F,0x02,0x0C,0x02,0x7F}, //M
    {0x7F,0x04,0x08,0x10,0x7F}, //N
    {0x3E,0x41,0x41,0x41,0x3E}, //O
    {0x7F,0x09,0x09,0x09,0x06}, //P
    {0x3E,0x41,0x51,0x21,0x5E}, //Q
    {0x7F,0x09,0x19,0x29,0x46}, //R
    {0x46,0x49,0x49,0x49,0x31}, //S
    {0x01,0x01,0x7F,0x01,0x01}, //T
    {0x3F,0x40,0x40,0x40,0x3F}, //U
    {0x1F,0x20,0x40,0x20,0x1F}, //V
    {0x7F,0x20,0x18,0x20,0x7F}, //W
    {0x63,0x14,0x08,0x14,0x63}, //X
    {0x07,0x08,0x70,0x08,0x07}, //Y
    {0x61,0x51,0x49,0x45,0x43}, //Z
    {0x00,0x1C,0x22,0x41,0x00}, //(
    {0x00,0x41,0x22,0x1C,0x00}, //)
    {0x00,0x60,0x60,0x00,0x00}, //.
    {0x00,0x08,0x08,0x00,0x00}  //:
};

int charIndex(char c) {
    if (c == ' ') return 0;
    if (c >= '0' && c <= '9') return 1 + (c - '0');
    if (c >= 'A' && c <= 'Z') return 11 + (c - 'A');
    if (c == '(') return 11 + 26;
    if (c == ')') return 12 + 26;
    if (c == '.') return 13 + 26;
    if (c == ':') return 14 + 26;
    return 0;
}

void drawChar(Image &img, int x, int y, char ch, u8 r, u8 g, u8 b) {
    if (ch >= 'a' && ch <= 'z') ch = ch - 'a' + 'A';
    int idx = charIndex(ch);
    const unsigned char *bmp = font5x7[idx];
    for (int col=0; col<5; ++col) {
        unsigned char coldata = bmp[col];
        for (int row=0; row<7; ++row) {
            if (coldata & (1 << row)) {
                img.setPixel(x + col, y + row, r,g,b);
            }
        }
    }
}

void drawText(Image &img, int x, int y, const std::string &text, u8 r, u8 g, u8 b) {
    int cx = x;
    for (char ch : text) {
        drawChar(img, cx, y, ch, r,g,b);
        cx += 6;
    }
}